<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practika Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .nav {
            background: #f7fafc;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .nav button:hover {
            background: #3182ce;
        }
        .nav button.active {
            background: #2b6cb0;
        }
        .content {
            padding: 30px;
            min-height: 600px;
        }
        .diagram-container {
            text-align: center;
            margin: 20px 0;
        }
        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        .error {
            background: #fed7d7;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
            color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Practika Architecture Diagrams</h1>
            <p>Interactive visualization of Personal Exercise Threads architecture and flows</p>
        </div>
        
        <div class="nav">
            <button onclick="showDiagram('architecture')" class="active">üèõÔ∏è System Architecture</button>
            <button onclick="showDiagram('database-erd')">üóÑÔ∏è Database ERD</button>
            <button onclick="showDiagram('user-journey')">üë§ User Journey</button>
            <button onclick="showDiagram('video-flow')">üé¨ Video Annotation Flow</button>
            <button onclick="showDiagram('access-control')">üîê Access Control</button>
            <button onclick="showDiagram('api-surface')">üîå API Surface</button>
            <button onclick="showDiagram('progress-dashboard')">üìä Progress Dashboard</button>
            <button onclick="showDiagram('mobile-interface')">üì± Mobile Interface</button>
        </div>
        
        <div class="content">
            <div id="diagram-content">
                <div class="loading">Loading diagram...</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            themeVariables: {
                primaryColor: '#4299e1',
                primaryTextColor: '#2d3748',
                primaryBorderColor: '#3182ce',
                lineColor: '#e2e8f0',
                secondaryColor: '#f7fafc',
                tertiaryColor: '#ebf8ff'
            }
        });

        // Diagram definitions
        const diagrams = {
            'architecture': {
                title: 'Practika - Complete Video Practice Platform',
                description: 'Comprehensive platform architecture with all user flows and technical components',
                mermaid: `graph TB
    subgraph "Teacher Content"
        TEACHER[Teacher Upload<br/>Video Exercise]
        EXERCISE[Exercise Library<br/>Structured Content]
        QUALITY[Quality Control<br/>Teacher Review]
    end

    subgraph "Student Practice"
        STUDENT[Student Practice<br/>Webcam Recording]
        COMPARE[Self Comparison<br/>Progress Tracking]
        THREAD[Practice Threads<br/>Linked to Exercise]
        ANALYTICS[Progress Analytics<br/>Measurable Growth]
    end

    subgraph "Video Platform"
        VP[Video Player<br/>Exercise + Practice]
        RECORD[Recording System<br/>Webcam Integration]
        STORAGE[Video Storage<br/>S3 + CDN]
        PROCESS[Video Processing<br/>Compression + Analysis]
    end

    subgraph "Threading System"
        THREAD_MGR[Thread Manager<br/>Exercise ‚Üí Practice]
        COMMENTS[Video Comments<br/>Mandatory Video]
        TIMELINE[Practice Timeline<br/>Progress History]
        SHARING[Thread Sharing<br/>Peer Learning]
    end

    TEACHER --> EXERCISE
    EXERCISE --> QUALITY
    STUDENT --> COMPARE
    COMPARE --> THREAD
    THREAD --> ANALYTICS
    VP --> RECORD
    RECORD --> STORAGE
    STORAGE --> PROCESS
    THREAD_MGR --> COMMENTS
    COMMENTS --> TIMELINE
    TIMELINE --> SHARING`
            },
            'database-erd': {
                title: 'Practika - BETA Video Practice Platform',
                description: 'Database ERD for Jos√© (drumming student), Dorothy (Qi Gong teacher), and Jimmy (drumming teacher)',
                mermaid: `erDiagram
    %% Core Users - Jos√©, Dorothy, Jimmy
    User {
        uuid id PK
        string email UK
        string username UK
        string user_type
        string name
        json profile_data
        datetime created_at
        datetime last_active
    }
    
    %% Teacher Exercises (Jimmy & Dorothy)
    Exercise {
        uuid id PK
        uuid teacher_id FK
        string title
        string description
        string exercise_type
        string video_source
        string video_url
        int duration_seconds
        json learning_objectives
        datetime created_at
        datetime published_at
    }
    
    %% Student Practice Recordings (Jos√©)
    PracticeRecording {
        uuid id PK
        uuid student_id FK
        uuid exercise_id FK
        string recording_title
        int duration_seconds
        string video_url
        datetime recorded_at
        string practice_notes
        string practice_status
    }
    
    %% Practice Threads (Jos√©'s Learning Journey)
    PracticeThread {
        uuid id PK
        uuid student_id FK
        uuid exercise_id FK
        string thread_title
        string learning_goals
        datetime started_at
        datetime last_practice
        int total_practices
        string thread_status
    }
    
    %% Video Comments (Jos√© & Jimmy & Dorothy)
    VideoComment {
        uuid id PK
        uuid thread_id FK
        uuid author_id FK
        int timestamp_start
        int timestamp_end
        string comment_type
        text content
        string video_url
        datetime created_at
    }
    
    %% Practice Sessions (Jos√©'s Daily Practice)
    PracticeSession {
        uuid id PK
        uuid student_id FK
        uuid exercise_id FK
        datetime session_date
        int practice_duration
        string session_notes
        string session_status
    }
    
    %% Teacher-Student Relationships
    TeacherStudent {
        uuid id PK
        uuid student_id FK
        uuid teacher_id FK
        string subject
        datetime started_at
        string relationship_status
    }
    
    %% Practice Goals (Jimmy's Instructions)
    PracticeGoal {
        uuid id PK
        uuid teacher_id FK
        uuid student_id FK
        uuid exercise_id FK
        string goal_description
        int target_duration
        string frequency
        datetime assigned_at
        string goal_status
    }

    %% Relationships
    User ||--o{ Exercise : "creates"
    User ||--o{ PracticeRecording : "records"
    User ||--o{ PracticeThread : "maintains"
    User ||--o{ VideoComment : "creates"
    User ||--o{ TeacherStudent : "student_of"
    User ||--o{ PracticeSession : "logs"
    User ||--o{ PracticeGoal : "assigns"
    
    Exercise ||--o{ PracticeRecording : "practiced_in"
    Exercise ||--o{ PracticeThread : "threaded_by"
    Exercise ||--o{ PracticeSession : "practiced_in"
    Exercise ||--o{ PracticeGoal : "assigned_in"
    
    PracticeThread ||--o{ PracticeRecording : "contains"
    PracticeThread ||--o{ VideoComment : "receives"
    
    PracticeSession ||--o{ VideoComment : "receives"`
            },
            'user-journey': {
                title: 'Jos√©\'s Practice Upload Flow - Detailed UI Wireframes',
                description: 'Step-by-step UI flow for Jos√© uploading practice videos with webcam recording',
                mermaid: `journey
    title Jos√©'s Practice Upload Flow - Detailed UI Wireframes
    section Login & Discovery
      Jos√© Opens Practika App: 5: Jos√©
      Jos√© Logs in with Email/Password: 5: Jos√©
      Jos√© Sees Dashboard with Recent Exercises: 5: Jos√©
      Jos√© Clicks on Jimmy's Drumming Exercise: 5: Jos√©
    section Exercise Preview
      Jos√© Views Exercise Details Page: 5: Jos√©
      Jos√© Watches Jimmy's Exercise Video: 5: Jos√©
      Jos√© Reads Learning Objectives: 4: Jos√©
      Jos√© Clicks "Start Practice Session": 5: Jos√©
    section Webcam Setup
      Jos√© Grants Camera Permission: 4: Jos√©
      Jos√© Sees Camera Preview: 5: Jos√©
      Jos√© Adjusts Camera Position: 4: Jos√©
      Jos√© Clicks "Start Recording": 5: Jos√©
    section Practice Recording
      Jos√© Practices Drumming Exercise: 5: Jos√©
      Jos√© Sees Recording Timer: 4: Jos√©
      Jos√© Clicks "Stop Recording": 5: Jos√©
      Jos√© Reviews Recording Preview: 4: Jos√©
    section Upload Process
      Jos√© Adds Practice Title: 4: Jos√©
      Jos√© Writes Practice Notes: 4: Jos√©
      Jos√© Clicks "Upload Practice": 5: Jos√©
      Jos√© Sees Upload Progress Bar: 4: Jos√©
      Jos√© Gets Upload Confirmation: 5: Jos√©
    section Thread Creation
      Jos√© Views New Practice Thread: 5: Jos√©
      Jos√© Adds Video Comment: 4: Jos√©
      Jos√© Sets Learning Goals: 4: Jos√©
      Jos√© Saves Thread Settings: 5: Jos√©`
            },
            'video-flow': {
                title: 'Video Processing Architecture - Storage & Compression',
                description: 'Technical architecture for video upload, processing, compression, and storage',
                mermaid: `sequenceDiagram
    participant USER as Jos√©/Jimmy
    participant UI as Frontend App
    participant API as Backend API
    participant PROCESSOR as Video Processor
    participant S3 as S3 Storage
    participant CDN as CloudFront CDN
    participant DB as Database

    Note over USER,DB: Video Upload Process
    USER->>UI: Upload video file
    UI->>API: POST /upload/video {file, metadata}
    API->>PROCESSOR: Send to video processor
    PROCESSOR->>S3: Store original video
    S3-->>PROCESSOR: Original stored
    PROCESSOR-->>API: Upload confirmed

    Note over USER,DB: Video Processing Pipeline
    API->>PROCESSOR: Process video (compress, analyze)
    PROCESSOR->>PROCESSOR: Compress to multiple formats
    PROCESSOR->>PROCESSOR: Generate thumbnails
    PROCESSOR->>PROCESSOR: Extract metadata
    PROCESSOR->>S3: Store processed videos
    S3-->>PROCESSOR: Processed videos stored

    Note over USER,DB: CDN Distribution
    PROCESSOR->>CDN: Distribute to CDN
    CDN-->>PROCESSOR: CDN ready
    PROCESSOR->>API: Processing complete
    API->>DB: Store video metadata
    DB-->>API: Metadata saved
    API-->>UI: Video ready
    UI-->>USER: Upload successful

    Note over USER,DB: Video Playback
    USER->>UI: Request video playback
    UI->>API: GET /video/{id}
    API->>CDN: Get video URL
    CDN-->>API: Video URL
    API-->>UI: Video URL
    UI-->>USER: Video playing`
            },
            'access-control': {
                title: 'YouTube Integration Flow - Dorothy\'s Video Linking',
                description: 'How Dorothy links existing YouTube videos as exercises without re-recording',
                mermaid: `sequenceDiagram
    participant DOROTHY as Dorothy (Teacher)
    participant UI as Practika UI
    participant API as Backend API
    participant YT as YouTube API
    participant DB as Database
    participant JOSE as Jos√© (Student)

    Note over DOROTHY,JOSE: YouTube Video Discovery
    DOROTHY->>UI: Click "Add YouTube Exercise"
    UI->>DOROTHY: Show YouTube URL input
    DOROTHY->>UI: Paste YouTube URL
    UI->>API: POST /exercises/youtube/validate {url}
    API->>YT: Get video metadata
    YT-->>API: Video info (title, duration, thumbnail)
    API-->>UI: Video validated
    UI-->>DOROTHY: Show video preview

    Note over DOROTHY,JOSE: Exercise Creation
    DOROTHY->>UI: Confirm video selection
    DOROTHY->>UI: Add exercise title
    DOROTHY->>UI: Add description
    DOROTHY->>UI: Set difficulty level
    DOROTHY->>UI: Add learning objectives
    UI->>API: POST /exercises {youtube_url, title, description}
    API->>DB: Create exercise record
    DB-->>API: Exercise created
    API-->>UI: Exercise published
    UI-->>DOROTHY: Exercise ready

    Note over DOROTHY,JOSE: Student Assignment
    DOROTHY->>UI: Select Jos√© as student
    DOROTHY->>UI: Set practice goals
    UI->>API: POST /practice_goals {student_id, exercise_id}
    API->>DB: Assign exercise to Jos√©
    DB-->>API: Assignment saved
    API->>JOSE: Send notification
    JOSE-->>API: Jos√© receives exercise

    Note over DOROTHY,JOSE: Progress Monitoring
    DOROTHY->>UI: View Jos√©'s progress
    UI->>API: GET /students/{jose_id}/progress
    API->>DB: Query Jos√©'s practice data
    DB-->>API: Progress data
    API-->>UI: Progress dashboard
    UI-->>DOROTHY: Show Jos√©'s improvement`
            },
            'api-surface': {
                title: 'Real-time Comment System - Jimmy\'s Video Feedback',
                description: 'Real-time video comment system for Jimmy to give feedback to Jos√©',
                mermaid: `sequenceDiagram
    participant JIMMY as Jimmy (Teacher)
    participant JOSE as Jos√© (Student)
    participant UI as Practika UI
    participant API as Backend API
    participant WEBSOCKET as WebSocket Server
    participant STORAGE as Video Storage
    participant DB as Database

    Note over JIMMY,JOSE: Jimmy Reviews Jos√©'s Practice
    JIMMY->>UI: Open Jos√©'s practice thread
    UI->>API: GET /threads/{thread_id}
    API->>DB: Fetch thread data
    DB-->>API: Thread with Jos√©'s videos
    API-->>UI: Thread loaded
    UI-->>JIMMY: Show Jos√©'s practice videos

    Note over JIMMY,JOSE: Jimmy Records Video Feedback
    JIMMY->>UI: Click "Add Video Comment"
    UI->>JIMMY: Activate camera
    JIMMY->>UI: Start recording feedback
    UI->>STORAGE: Begin video capture
    STORAGE-->>UI: Recording active
    JIMMY->>UI: Stop recording
    UI->>STORAGE: Stop recording
    STORAGE-->>UI: Video saved

    Note over JIMMY,JOSE: Real-time Comment Creation
    JIMMY->>UI: Add comment text
    JIMMY->>UI: Set timestamp range
    JIMMY->>UI: Click "Post Comment"
    UI->>API: POST /comments {video_url, content, timestamp}
    API->>STORAGE: Store comment video
    STORAGE-->>API: Video stored
    API->>DB: Save comment
    DB-->>API: Comment saved

    Note over JIMMY,JOSE: Real-time Notification
    API->>WEBSOCKET: Broadcast new comment
    WEBSOCKET->>JOSE: Send real-time notification
    JOSE-->>WEBSOCKET: Jos√© receives notification
    JOSE->>UI: View Jimmy's feedback
    UI->>API: GET /comments/{comment_id}
    API-->>UI: Comment data
    UI-->>JOSE: Show Jimmy's video feedback`
            },
            'progress-dashboard': {
                title: 'Progress Dashboard Design - Jos√©\'s Improvement Tracking',
                description: 'Comprehensive dashboard showing Jos√©\'s practice progress and improvement over time',
                mermaid: `graph TB
    subgraph "Jos√©'s Learning Dashboard"
        HEADER[Jos√©'s Progress Dashboard]
        WELCOME[Welcome back, Jos√©!]
        QUICK_STATS[Quick Stats]
        RECENT_ACTIVITY[Recent Activity]
    end

    subgraph "Practice Statistics"
        TOTAL_SESSIONS[Total Practice Sessions: 47]
        TOTAL_HOURS[Total Practice Hours: 23.5]
        CURRENT_STREAK[Current Streak: 5 days]
        IMPROVEMENT_SCORE[Improvement Score: 85%]
    end

    subgraph "Exercise Progress"
        DRUMMING_PROGRESS[Drumming Exercises: 8/12 completed]
        QIGONG_PROGRESS[Qi Gong Exercises: 5/8 completed]
        RECENT_VIDEOS[Recent Practice Videos: 3 new]
        PENDING_FEEDBACK[Pending Feedback: 2 from Jimmy]
    end

    subgraph "Learning Goals"
        DAILY_GOAL[Daily Goal: 10 min drumming ‚úì]
        WEEKLY_TARGET[Weekly Target: 5 sessions ‚úì]
        MONTHLY_MILESTONE[Monthly Milestone: Master basic rhythm]
        ACHIEVEMENTS[Achievements: 3 badges earned]
    end

    subgraph "Progress Timeline"
        TIMELINE[Practice Timeline - Last 30 Days]
        BEFORE_AFTER[Before/After Comparison Videos]
        KEY_MILESTONES[Key Milestones: 5 reached]
        LEARNING_INSIGHTS[Learning Insights: 12 generated]
    end

    subgraph "Teacher Feedback"
        JIMMY_FEEDBACK[Jimmy's Latest Feedback: 2 hours ago]
        DOROTHY_FEEDBACK[Dorothy's Qi Gong Notes: 1 day ago]
        FEEDBACK_HISTORY[Feedback History: 23 total]
        IMPROVEMENT_AREAS[Areas for Improvement: 3 identified]
    end

    HEADER --> WELCOME
    HEADER --> QUICK_STATS
    HEADER --> RECENT_ACTIVITY
    QUICK_STATS --> TOTAL_SESSIONS
    QUICK_STATS --> TOTAL_HOURS
    QUICK_STATS --> CURRENT_STREAK
    QUICK_STATS --> IMPROVEMENT_SCORE
    RECENT_ACTIVITY --> DRUMMING_PROGRESS
    RECENT_ACTIVITY --> QIGONG_PROGRESS
    RECENT_ACTIVITY --> RECENT_VIDEOS
    RECENT_ACTIVITY --> PENDING_FEEDBACK
    WELCOME --> DAILY_GOAL
    WELCOME --> WEEKLY_TARGET
    WELCOME --> MONTHLY_MILESTONE
    WELCOME --> ACHIEVEMENTS
    HEADER --> TIMELINE
    HEADER --> BEFORE_AFTER
    HEADER --> KEY_MILESTONES
    HEADER --> LEARNING_INSIGHTS
    HEADER --> JIMMY_FEEDBACK
    HEADER --> DOROTHY_FEEDBACK
    HEADER --> FEEDBACK_HISTORY
    HEADER --> IMPROVEMENT_AREAS`
            },
            'mobile-interface': {
                title: 'Mobile Interface Flows - Jimmy\'s On-the-Go Recording',
                description: 'Mobile app flows for Jimmy to record exercises from anywhere using phone/laptop',
                mermaid: `journey
    title Mobile Interface Flows - Jimmy's On-the-Go Recording
    section Quick Access
      Jimmy Opens Mobile App: 5: Jimmy
      Jimmy Sees Quick Actions Menu: 5: Jimmy
      Jimmy Clicks "Record Exercise": 5: Jimmy
      Jimmy Grants Camera Permission: 4: Jimmy
    section Exercise Recording
      Jimmy Positions Phone Camera: 5: Jimmy
      Jimmy Clicks "Start Recording": 5: Jimmy
      Jimmy Records Drumming Exercise: 5: Jimmy
      Jimmy Clicks "Stop Recording": 5: Jimmy
      Jimmy Reviews Recording: 4: Jimmy
    section Quick Details
      Jimmy Adds Exercise Title: 4: Jimmy
      Jimmy Selects Difficulty Level: 4: Jimmy
      Jimmy Adds Brief Description: 4: Jimmy
      Jimmy Clicks "Save Exercise": 5: Jimmy
    section Student Assignment
      Jimmy Selects Jos√© from List: 4: Jimmy
      Jimmy Sets Practice Goal: 4: Jimmy
      Jimmy Clicks "Assign to Jos√©": 5: Jimmy
      Jimmy Gets Confirmation: 5: Jimmy
    section Follow-up Actions
      Jimmy Views Exercise Dashboard: 4: Jimmy
      Jimmy Checks Jos√©'s Progress: 4: Jimmy
      Jimmy Records Video Feedback: 4: Jimmy
      Jimmy Sends Encouragement: 3: Jimmy`
            }
        };

        // Function to show diagram
        function showDiagram(diagramKey) {
            const diagram = diagrams[diagramKey];
            if (!diagram) {
                document.getElementById('diagram-content').innerHTML = '<div class="error">Diagram not found</div>';
                return;
            }

            // Update active button
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Show diagram
            document.getElementById('diagram-content').innerHTML = `
                <div class="info">
                    <h2>${diagram.title}</h2>
                    <p>${diagram.description}</p>
                </div>
                <div class="diagram-container">
                    <div class="mermaid">
                        ${diagram.mermaid}
                    </div>
                </div>
            `;

            // Reinitialize Mermaid
            mermaid.init();
        }

        // Show default diagram
        showDiagram('architecture');
    </script>
</body>
</html>
