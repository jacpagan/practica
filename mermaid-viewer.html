<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practika Architecture Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .nav {
            background: #f7fafc;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .nav button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .nav button:hover {
            background: #3182ce;
        }
        .nav button.active {
            background: #2b6cb0;
        }
        .content {
            padding: 30px;
            min-height: 600px;
        }
        .diagram-container {
            text-align: center;
            margin: 20px 0;
        }
        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }
        .error {
            background: #fed7d7;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
            color: #c53030;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è Practika Architecture Diagrams</h1>
            <p>Interactive visualization of your AWS infrastructure and app flows</p>
        </div>
        
        <div class="nav">
            <button onclick="showDiagram('architecture')" class="active">üèõÔ∏è System Architecture</button>
            <button onclick="showDiagram('aws-infrastructure')">‚òÅÔ∏è AWS Infrastructure</button>
            <button onclick="showDiagram('user-journey')">üë§ User Journey</button>
            <button onclick="showDiagram('video-flow')">üé¨ Video Annotation Flow</button>
            <button onclick="showDiagram('playlist-flow')">üìã Playlist Creation Flow</button>
            <button onclick="showDiagram('database-erd')">üóÑÔ∏è Database ERD</button>
        </div>
        
        <div class="content">
            <div id="diagram-content">
                <div class="loading">Loading diagram...</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            themeVariables: {
                primaryColor: '#4299e1',
                primaryTextColor: '#2d3748',
                primaryBorderColor: '#3182ce',
                lineColor: '#e2e8f0',
                secondaryColor: '#f7fafc',
                tertiaryColor: '#ebf8ff'
            }
        });

        // Diagram definitions
        const diagrams = {
            'architecture': {
                title: 'System Architecture Overview',
                description: 'Complete AWS infrastructure visualization with component relationships',
                mermaid: `graph TB
    subgraph "Frontend Layer"
        UI[React Frontend<br/>Vite + Tailwind]
        CF[CloudFront CDN]
        S3_STATIC[S3 Static Hosting]
    end

    subgraph "API Layer"
        ALB[Application Load Balancer]
        API[Django REST API<br/>ECS Fargate]
        AUTH[JWT Authentication]
    end

    subgraph "Data Layer"
        RDS[(PostgreSQL RDS)]
        S3_VIDEOS[S3 Video Storage]
        S3_LOGS[S3 Log Storage]
        SECRETS[Secrets Manager]
    end

    subgraph "Infrastructure"
        VPC[VPC with Private Subnets]
        ECS[ECS Fargate Cluster]
        WAF[AWS WAF]
        CW[CloudWatch]
    end

    subgraph "External Services"
        ROUTE53[Route53 DNS]
        ACM[SSL Certificates]
        ECR[ECR Container Registry]
    end

    %% Frontend connections
    UI --> CF
    CF --> S3_STATIC
    UI --> API

    %% API connections
    ALB --> API
    API --> AUTH
    API --> RDS
    API --> S3_VIDEOS
    API --> SECRETS

    %% Infrastructure connections
    VPC --> ECS
    VPC --> RDS
    WAF --> ALB
    CW --> API
    CW --> ALB

    %% External connections
    ROUTE53 --> CF
    ROUTE53 --> ALB
    ACM --> CF
    ACM --> ALB
    ECR --> ECS

    %% Styling
    classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef api fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef data fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef infra fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef external fill:#fce4ec,stroke:#880e4f,stroke-width:2px

    class UI,CF,S3_STATIC frontend
    class ALB,API,AUTH api
    class RDS,S3_VIDEOS,S3_LOGS,SECRETS data
    class VPC,ECS,WAF,CW infra
    class ROUTE53,ACM,ECR external`
            },
            'aws-infrastructure': {
                title: 'AWS Infrastructure Components',
                description: 'Detailed breakdown of AWS services and their configurations',
                mermaid: `graph TB
    subgraph "Global Services"
        ROUTE53[Route53<br/>DNS Management]
        ACM[ACM<br/>SSL Certificates]
        CLOUDFRONT[CloudFront<br/>CDN Distribution]
    end

    subgraph "Compute & Storage"
        ECS[ECS Fargate<br/>Container Orchestration]
        ECR[ECR<br/>Container Registry]
        S3_VIDEOS[S3 Video Storage<br/>Movement Videos]
        S3_STATIC[S3 Static Hosting<br/>Frontend Assets]
        S3_LOGS[S3 Log Storage<br/>Application Logs]
    end

    subgraph "Networking"
        VPC[VPC<br/>Virtual Private Cloud]
        ALB[ALB<br/>Application Load Balancer]
        SG[Security Groups<br/>Network Security]
        NAT[NAT Gateway<br/>Internet Access]
        SUBNET_PUB[Public Subnets<br/>ALB, NAT]
        SUBNET_PRIV[Private Subnets<br/>ECS, RDS]
    end

    subgraph "Database & Security"
        RDS[(RDS PostgreSQL<br/>Primary Database)]
        SECRETS[Secrets Manager<br/>Credential Storage]
        WAF[WAF<br/>Web Application Firewall]
        IAM[IAM<br/>Identity & Access Management]
    end

    subgraph "Monitoring & Observability"
        CW_LOGS[CloudWatch Logs<br/>Application Logging]
        CW_METRICS[CloudWatch Metrics<br/>Performance Monitoring]
        CW_ALARMS[CloudWatch Alarms<br/>Alerting]
        XRAY[X-Ray<br/>Distributed Tracing]
    end

    %% Global connections
    ROUTE53 --> CLOUDFRONT
    ROUTE53 --> ALB
    ACM --> CLOUDFRONT
    ACM --> ALB

    %% CDN connections
    CLOUDFRONT --> S3_STATIC
    CLOUDFRONT --> S3_VIDEOS

    %% Networking connections
    VPC --> SUBNET_PUB
    VPC --> SUBNET_PRIV
    SUBNET_PUB --> ALB
    SUBNET_PUB --> NAT
    SUBNET_PRIV --> ECS
    SUBNET_PRIV --> RDS
    ALB --> ECS
    NAT --> ECS
    SG --> ALB
    SG --> ECS
    SG --> RDS

    %% Compute connections
    ECR --> ECS
    ECS --> S3_VIDEOS
    ECS --> S3_LOGS
    ECS --> RDS
    ECS --> SECRETS

    %% Security connections
    WAF --> ALB
    IAM --> ECS
    IAM --> RDS
    IAM --> S3_VIDEOS

    %% Monitoring connections
    CW_LOGS --> ECS
    CW_METRICS --> ECS
    CW_METRICS --> ALB
    CW_ALARMS --> CW_METRICS
    XRAY --> ECS

    %% Styling
    classDef global fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef compute fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef network fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef security fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef monitoring fill:#fce4ec,stroke:#880e4f,stroke-width:2px

    class ROUTE53,ACM,CLOUDFRONT global
    class ECS,ECR,S3_VIDEOS,S3_STATIC,S3_LOGS compute
    class VPC,ALB,SG,NAT,SUBNET_PUB,SUBNET_PRIV network
    class RDS,SECRETS,WAF,IAM security
    class CW_LOGS,CW_METRICS,CW_ALARMS,XRAY monitoring`
            },
            'user-journey': {
                title: 'User Journey Flow',
                description: 'Emotional journey map with satisfaction levels',
                mermaid: `journey
    title Practika User Journey
    section Discovery
      User visits app: 5: User
      User browses moments: 4: User
      User filters by category: 3: User
      User finds interesting moment: 5: User
    section Registration
      User clicks sign up: 3: User
      User fills registration form: 2: User
      User verifies email: 4: User
      User completes profile: 3: User
    section Content Creation
      User uploads movement video: 5: User
      User adds moment details: 4: User
      User categorizes moment: 3: User
      User adds tags: 3: User
      User publishes moment: 5: User
    section Video Annotation
      User watches movement video: 4: User
      User adds form correction: 5: User
      User adds technique tip: 4: User
      User sets timestamp: 3: User
      User saves annotation: 5: User
    section Playlist Creation
      User creates new playlist: 4: User
      User adds moments to playlist: 5: User
      User arranges order: 3: User
      User saves playlist: 4: User
    section Progress Tracking
      User records workout: 4: User
      User tracks progress: 5: User
      User views analytics: 4: User
      User celebrates achievements: 5: User
    section Social Features
      User shares playlist: 4: User
      User follows other users: 3: User
      User receives notifications: 4: User
      User participates in community: 5: User`
            },
            'video-flow': {
                title: 'Video Annotation Flow',
                description: 'Video upload and annotation process',
                mermaid: `sequenceDiagram
    participant U as User
    participant F as Frontend
    participant A as API
    participant S3 as S3 Storage
    participant DB as Database

    Note over U,DB: Video Upload Process
    U->>F: Upload movement video
    F->>A: Request presigned URL
    A->>S3: Generate presigned URL
    S3-->>A: Return presigned URL
    A-->>F: Return presigned URL
    F->>S3: Upload video directly
    S3-->>F: Upload confirmation
    F->>A: Create moment video record
    A->>DB: Save video metadata
    DB-->>A: Video record created
    A-->>F: Video uploaded successfully
    F-->>U: Video ready for annotation

    Note over U,DB: Annotation Creation Process
    U->>F: Click "Add Annotation"
    F->>F: Show annotation form
    U->>F: Select annotation type
    U->>F: Set timestamp (15.5s)
    U->>F: Enter content
    U->>F: Set coordinates (optional)
    U->>F: Choose visibility (public/private)
    U->>F: Click "Save Annotation"
    F->>A: POST /annotations/
    A->>DB: Create annotation record
    DB-->>A: Annotation saved
    A-->>F: Annotation created
    F-->>U: Annotation appears on video

    Note over U,DB: Real-time Collaboration
    U->>F: View video with annotations
    F->>A: GET /annotations/?video_id=X
    A->>DB: Query annotations
    DB-->>A: Return annotations
    A-->>F: Return annotations
    F-->>U: Display all annotations

    Note over U,DB: Annotation Interaction
    U->>F: Click on annotation
    F->>F: Show annotation details
    U->>F: Rate annotation helpfulness
    F->>A: POST /annotations/{id}/rate
    A->>DB: Update rating
    DB-->>A: Rating saved
    A-->>F: Rating updated
    F-->>U: Show updated rating

    Note over U,DB: Annotation Moderation
    U->>F: Report inappropriate annotation
    F->>A: POST /annotations/{id}/report
    A->>DB: Create report record
    DB-->>A: Report saved
    A-->>F: Report submitted
    F-->>U: Confirmation message`
            },
            'playlist-flow': {
                title: 'Playlist Creation Flow',
                description: 'Playlist creation and execution process',
                mermaid: `flowchart TD
    subgraph "Playlist Creation"
        START([User wants to create playlist])
        TITLE[Add title]
        DESCRIPTION[Add description]
        TAGS[Add tags]
        VISIBILITY[Set visibility]
    end

    subgraph "Moment Selection"
        BROWSE[Browse moments]
        SEARCH[Search by keyword]
        FILTER[Filter by category/difficulty]
        PREVIEW[Preview moment]
        SELECT[Add to playlist]
    end

    subgraph "Playlist Organization"
        ORDER[Arrange order]
        SETS[Set number of sets]
        REPS[Set number of reps]
        DURATION[Set duration]
        NOTES[Add personal notes]
    end

    subgraph "Playlist Management"
        SAVE[Save playlist]
        SHARE[Share with others]
        EXPORT[Export playlist]
        DUPLICATE[Duplicate playlist]
    end

    subgraph "Playlist Execution"
        START_PLAYLIST[Start playlist]
        TRACK_PROGRESS[Track progress]
        MARK_COMPLETE[Mark moments complete]
        RECORD_RESULTS[Record results]
        SAVE_PROGRESS[Save progress]
    end

    %% Flow connections
    START --> TITLE
    TITLE --> DESCRIPTION
    DESCRIPTION --> TAGS
    TAGS --> VISIBILITY
    VISIBILITY --> BROWSE

    BROWSE --> SEARCH
    SEARCH --> FILTER
    FILTER --> PREVIEW
    PREVIEW --> SELECT
    SELECT --> ORDER

    ORDER --> SETS
    SETS --> REPS
    REPS --> DURATION
    DURATION --> NOTES
    NOTES --> SAVE

    SAVE --> SHARE
    SHARE --> EXPORT
    EXPORT --> DUPLICATE
    DUPLICATE --> START_PLAYLIST

    START_PLAYLIST --> TRACK_PROGRESS
    TRACK_PROGRESS --> MARK_COMPLETE
    MARK_COMPLETE --> RECORD_RESULTS
    RECORD_RESULTS --> SAVE_PROGRESS

    %% Styling
    classDef creation fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef selection fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef organization fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef management fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef execution fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class START,TITLE,DESCRIPTION,TAGS,VISIBILITY creation
    class BROWSE,SEARCH,FILTER,PREVIEW,SELECT selection
    class ORDER,SETS,REPS,DURATION,NOTES organization
    class SAVE,SHARE,EXPORT,DUPLICATE management
    class START_PLAYLIST,TRACK_PROGRESS,MARK_COMPLETE,RECORD_RESULTS,SAVE_PROGRESS execution`
            },
            'database-erd': {
                title: 'Database Entity Relationship Diagram',
                description: 'Complete database schema with relationships',
                mermaid: `erDiagram
    auth_user {
        int id PK
        string username UK
        string email UK
        string password
        string first_name
        string last_name
        boolean is_active
        boolean is_staff
        boolean is_superuser
        timestamp date_joined
        timestamp last_login
    }

    users_profile {
        int id PK
        int user_id FK
        text bio
        string profile_picture
        date date_of_birth
        int height_cm
        decimal weight_kg
        string fitness_level
        timestamp created_at
        timestamp updated_at
    }

    exercises_category {
        int id PK
        string name
        text description
        string icon
        string color
        timestamp created_at
    }

    exercises_exercise {
        int id PK
        string title
        text description
        int category_id FK
        string difficulty_level
        array equipment_needed
        array muscle_groups
        text instructions
        text tips
        int created_by FK
        boolean is_public
        timestamp created_at
        timestamp updated_at
    }

    exercises_exercisevideo {
        int id PK
        int exercise_id FK
        string video_file
        string thumbnail
        int duration_seconds
        bigint file_size_bytes
        string s3_key
        int created_by FK
        timestamp created_at
    }

    exercises_tag {
        int id PK
        string name UK
        timestamp created_at
    }

    exercises_exercise_tags {
        int id PK
        int exercise_id FK
        int tag_id FK
    }

    workouts_workout {
        int id PK
        int user_id FK
        string title
        text notes
        timestamp start_time
        timestamp end_time
        int total_duration_minutes
        timestamp created_at
    }

    workouts_workoutexercise {
        int id PK
        int workout_id FK
        int exercise_id FK
        int sets
        int reps
        int duration_seconds
        decimal weight_kg
        int order_index
        text notes
        timestamp created_at
    }

    annotations_videoannotation {
        int id PK
        int exercise_video_id FK
        int user_id FK
        string annotation_type
        decimal timestamp_start
        decimal timestamp_end
        text content
        jsonb coordinates
        boolean is_public
        timestamp created_at
        timestamp updated_at
    }

    users_userfavorite {
        int id PK
        int user_id FK
        int exercise_id FK
        timestamp created_at
    }

    %% Relationships
    auth_user ||--o{ users_profile : "has"
    auth_user ||--o{ exercises_exercise : "creates"
    auth_user ||--o{ exercises_exercisevideo : "uploads"
    auth_user ||--o{ workouts_workout : "owns"
    auth_user ||--o{ annotations_videoannotation : "creates"
    auth_user ||--o{ users_userfavorite : "favorites"

    exercises_category ||--o{ exercises_exercise : "categorizes"
    exercises_exercise ||--o{ exercises_exercisevideo : "has"
    exercises_exercise ||--o{ exercises_exercise_tags : "tagged_with"
    exercises_tag ||--o{ exercises_exercise_tags : "tags"

    workouts_workout ||--o{ workouts_workoutexercise : "contains"
    exercises_exercise ||--o{ workouts_workoutexercise : "included_in"

    exercises_exercisevideo ||--o{ annotations_videoannotation : "annotated"
    exercises_exercise ||--o{ users_userfavorite : "favorited"`
            }
        };

        // Function to show diagram
        function showDiagram(type) {
            const diagram = diagrams[type];
            if (!diagram) {
                document.getElementById('diagram-content').innerHTML = '<div class="error">Diagram not found</div>';
                return;
            }

            // Update active button
            document.querySelectorAll('.nav button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Show loading
            document.getElementById('diagram-content').innerHTML = '<div class="loading">Loading diagram...</div>';

            // Render diagram
            setTimeout(() => {
                const content = `
                    <h2>${diagram.title}</h2>
                    <div class="info">
                        <strong>Description:</strong> ${diagram.description}
                    </div>
                    <div class="diagram-container">
                        <div class="mermaid">
                            ${diagram.mermaid}
                        </div>
                    </div>
                `;
                document.getElementById('diagram-content').innerHTML = content;
                mermaid.init();
            }, 100);
        }

        // Show default diagram on load
        window.onload = function() {
            showDiagram('architecture');
        };
    </script>
</body>
</html>
